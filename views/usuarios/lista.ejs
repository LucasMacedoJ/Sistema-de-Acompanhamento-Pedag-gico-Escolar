<%- include('../tela') %>

<head>
  <link rel="stylesheet" href="/css/usuarios.css">
</head>

<h1>Lista de Usuários</h1>
<div class="container">
  <table>
    <thead>
      <tr>
        <th>Foto</th>
        <th>Nome</th>
        <th>Email</th>
        <th>Perfil</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <% usuarios.forEach(function(u) { %>
        <tr>
          <td>
            <% if (u.foto) { %>
              <img src="/uploads/<%= u.foto %>" alt="foto" style="width:40px;height:40px;border-radius:50%;">
            <% } else { %>
              <img src="/images/default-avatar.png" alt="sem foto" style="width:40px;height:40px;border-radius:50%;">
            <% } %>
          </td>
          <td><%= u.nome || '-' %></td>
          <td><%= u.email %></td>
          <td><%= u.perfil %></td>
          <td>
            <% if (usuario && (usuario.perfil === 'admin' || String(usuario._id) === String(u._id))) { %>
              <a class="btn" href="/usuarios/editar/<%= u._id %>">Editar</a>
            <% } %>

            <% if (usuario && usuario.perfil === 'admin') { %>
              <form action="/usuarios/excluir/<%= u._id %>" method="POST" style="display:inline"
                onsubmit="return confirm('Confirma exclusão deste usuário?');">
                <button type="submit" class="btn btn-danger">Excluir</button>
              </form>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>

  <% if (usuario && usuario.perfil === 'admin') { %>
    <a class="btn" href="/usuarios/novo" style="margin-top:1rem;display:inline-block;">Cadastrar novo usuário</a>
  <% } %>
</div>
