<%- include('../tela') %>

  <head>
    <link rel="stylesheet" href="/css/editarAluno.css">
  </head>

  <body>
    <div class="form-editar">
      <h1>Editar Aluno</h1>

      <form action="/alunos/editar/<%= aluno._id %>" method="POST" enctype="multipart/form-data">
        <!-- üßæ Nome -->
        <div>
          <label>Nome:</label>
          <input type="text" name="nome" value="<%= aluno.nome === 'Nenhum' ? '' : aluno.nome %>" required>
        </div>

        <!-- üè´ Turma -->
        <div>
          <label for="turma">Turma:</label><br>
          <select name="turma" id="turma" required>
            <option value="" disabled>Selecione uma turma</option>
            <% turmas.forEach(function(turma) { %>
              <option value="<%= turma._id %>" <%=aluno.turma && String(aluno.turma._id)===String(turma._id)
                ? 'selected' : '' %>>
                <%= turma.nome %>
              </option>
              <% }) %>
          </select>
        </div>

        <!-- üì∏ Foto -->
        <div>
          <label for="foto">Foto do Aluno:</label>
          <input type="file" name="foto" id="foto" accept="image/*">
          <% if (aluno.foto) { %>
            <p>Foto atual:</p>
            <img src="<%= aluno.foto.startsWith('http') ? aluno.foto : aluno.foto %>" alt="Foto do aluno"
              style="width:100px; border-radius:5px;">
            <% } %>
        </div>

        <!-- üß† Necessidade Especial -->
        <div>
          <label>Necessidades Especiais:</label><br>
          <div id="necessidadeE-container">
            <% const necessidadeEArray=Array.isArray(aluno.necessidadeE) ? aluno.necessidadeE : (aluno.necessidadeE ?
              [aluno.necessidadeE] : []); %>
              <% if (necessidadeEArray.length> 0) { %>
                <% necessidadeEArray.forEach(item=> { %>
                  <input type="text" name="necessidadeE[]" value="<%= item === 'Nenhum' ? '' : item %>"
                    placeholder="Necessidade especial">
                  <% }) %>
                    <% } else { %>
                      <input type="text" name="necessidadeE[]" placeholder="Necessidade especial">
                      <% } %>
          </div>
          <button type="button"
            onclick="adicionarInput('necessidadeE-container', 'Necessidade especial')">Adicionar</button>
        </div>

        <!-- ‚ù§Ô∏è Problemas de Sa√∫de -->
        <div>
          <label>Problemas de Sa√∫de:</label><br>
          <div id="problemaSaude-container">
            <% const problemaSaudeArray=Array.isArray(aluno.problemaSaude) ? aluno.problemaSaude : (aluno.problemaSaude
              ? [aluno.problemaSaude] : []); %>
              <% if (problemaSaudeArray.length> 0) { %>
                <% problemaSaudeArray.forEach(item=> { %>
                  <input type="text" name="problemaSaude[]" value="<%= item === 'Nenhum' ? '' : item %>"
                    placeholder="Problema de sa√∫de">
                  <% }) %>
                    <% } else { %>
                      <input type="text" name="problemaSaude[]" placeholder="Problema de sa√∫de">
                      <% } %>
          </div>
          <button type="button"
            onclick="adicionarInput('problemaSaude-container', 'Problema de sa√∫de')">Adicionar</button>
        </div>

        <!-- ‚öôÔ∏è Dificuldades Disciplinares -->
        <div>
          <label>Dificuldades Disciplinares:</label><br>
          <div id="disciplinaD-container">
            <% const disciplinaDArray=Array.isArray(aluno.disciplinaD) ? aluno.disciplinaD : (aluno.disciplinaD ?
              [aluno.disciplinaD] : []); %>
              <% if (disciplinaDArray.length> 0) { %>
                <% disciplinaDArray.forEach(item=> { %>
                  <input type="text" name="disciplinaD[]" value="<%= item === 'Nenhum' ? '' : item %>"
                    placeholder="Dificuldade disciplinar">
                  <% }) %>
                    <% } else { %>
                      <input type="text" name="disciplinaD[]" placeholder="Dificuldade disciplinar">
                      <% } %>
          </div>
          <button type="button"
            onclick="adicionarInput('disciplinaD-container', 'Dificuldade disciplinar')">Adicionar</button>
        </div>

        <!-- üè´ Transfer√™ncia -->
        <div>
          <label>Transfer√™ncia de onde:</label>
          <input type="text" name="transferenciaOnde"
            value="<%= aluno.transferenciaOnde === 'Nenhum' ? '' : aluno.transferenciaOnde %>"
            placeholder="Nome da escola anterior">
        </div>

        <div>
          <label>Descri√ß√£o da transfer√™ncia:</label>
          <input type="text" name="transferenciaD"
            value="<%= aluno.transferenciaD === 'Nenhum' ? '' : aluno.transferenciaD %>"
            placeholder="Motivo ou detalhes">
        </div>

        <!-- üë®‚Äçüë©‚Äçüëß Respons√°vel -->
        <div>
          <label>Nome do Respons√°vel:</label>
          <input type="text" name="responsavelNome"
            value="<%= aluno.responsavelNome === 'Nenhum' ? '' : aluno.responsavelNome %>" required>
        </div>

        <div>
          <label for="responsavelContato">Contato do Respons√°vel:</label>
          <input type="text" name="responsavelContato" id="responsavelContato" required placeholder="(99) 99999-9999"
            value="<%= aluno.responsavelContato === 'Nenhum' ? '' : aluno.responsavelContato %>" required>
        </div><br>
        <!-- üßë‚Äçüè´ Segundo Professor -->
        <div>
          <label>
            <input type="checkbox" name="segundoProfessor" <%=aluno.segundoProfessor ? 'checked' : '' %> Segundo
            Professor
          </label>
          <input type="text" name="segundoProfessorNome"
            value="<%= aluno.segundoProfessorNome === 'Nenhum' ? '' : aluno.segundoProfessorNome %>"
            placeholder="Nome do segundo professor">
        </div>

        <!-- üóíÔ∏è Observa√ß√£o -->
        <div>
          <label>Observa√ß√£o:</label><br>
          <textarea name="observacao" rows="4" cols="50"
            placeholder="Digite observa√ß√µes adicionais"><%= aluno.observacao === 'Nenhum' ? '' : aluno.observacao %></textarea>
        </div>

        <!-- üß≠ Bot√µes -->
        <div class="botoes">
          <button type="submit">Salvar altera√ß√µes</button>
          <a class="btn" href="/alunos/">Cancelar</a>
        </div>
      </form>
    </div>

    <script>
      // üì± M√°scara de telefone
      const telInput = document.getElementById('responsavelContato');
      if (telInput) VMasker(telInput).maskPattern('(99) 99999-9999');


      function adicionarInput(containerId, placeholder) {
        const container = document.getElementById(containerId);
        const input = document.createElement('input');
        input.type = 'text';
        input.name = containerId.replace('-container', '[]');
        input.placeholder = placeholder;
        container.appendChild(input);
      }
    </script>
  </body>